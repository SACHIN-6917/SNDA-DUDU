{% load static %}
{% if not "/login/" in request.path and not "/register/" in request.path %}
{% include 'cookie_banner.html' %}
<div class="hero-content" role="navigation" aria-label="Main">
    <!-- 1. Brand / Logo -->
    <a href="{% url 'index' %}" class="nav-brand">
        DUDU IV HUB
    </a>

    <!-- 2. Centered Navigation Links -->
    <ul class="nav-links-floating">
        <li><a href="{% url 'index' %}#home" id="nav-home">Home</a></li>
        <li><a href="{% url 'industrial_list' %}" id="nav-industrials">Industrials</a></li>
        <li><a href="{% url 'payment_list' %}" id="nav-payment">Payment</a></li>
        <li><a href="{% url 'feedback' %}" id="nav-feedback">Feedback's</a></li>
    </ul>
    
    <!-- 3. Right Actions (Theme + Account) -->
    <div class="nav-actions">
        <!-- Theme Toggle -->
        <button id="themeToggle" class="theme-toggle-btn" aria-label="Toggle dark mode">
            <i class="fas fa-moon"></i>
        </button>

    {% if request.user.is_authenticated %}
    <details class="account-dropdown">
        <summary>
            <button class="account-summary" aria-haspopup="menu" aria-expanded="false" style="display: flex; align-items: center; gap: 10px;">
                {% if request.user.profile.avatar %}
                    <img src="{{ request.user.profile.avatar.url }}" alt="User" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover; border: 2px solid white;">
                {% else %}
                    <img src="https://ui-avatars.com/api/?name={{ request.user.first_name|default:request.user.username }}&background=e96718&color=fff&size=50" alt="Avatar" style="width: 32px; height: 32px; border-radius: 50%;">
                {% endif %}
                <span class="user-name-pill">{{ request.user.first_name|default:request.user.username }}</span>
            </button>
        </summary>
        <div class="account-menu" role="menu" aria-label="Account">
            {% if request.user.is_staff or request.user.profile.role == 'admin' %}
                <a role="menuitem" href="{% url 'admin_dashboard' %}"><i class="fas fa-chart-line"></i> Admin Panel</a>
            {% else %}
                <a role="menuitem" href="{% url 'account' %}"><i class="fas fa-user-circle"></i> My Dashboard</a>
            {% endif %}
            <a role="menuitem" href="{% url 'settings' %}"><i class="fas fa-cog"></i> Settings</a>
            <a role="menuitem" href="{% url 'logout' %}" class="logout-link"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
    </details>
    {% else %}
    <a href="{% url 'login' %}" class="btn btn-primary" style="padding: 8px 20px; font-size: 0.9rem;">Login</a>
    {% endif %}
    </div>
</div>
{% endif %}

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const path = window.location.pathname;
        const hash = window.location.hash;
        
        if (path === '/') {
            document.getElementById('nav-home')?.classList.add('active');
        }
        else if (path.includes('industrial')) document.getElementById('nav-industrials')?.classList.add('active');
        else if (path.includes('payment')) document.getElementById('nav-payment')?.classList.add('active');
        else if (path.includes('feedback')) document.getElementById('nav-feedback')?.classList.add('active');
        else if (path.includes('account')) document.getElementById('nav-account')?.classList.add('active');
    });
</script>

<script>
    // Sync Django session to localStorage for script.js and others
    (function() {
        {% if request.user.is_authenticated %}
            const user = {
                id: "{{ request.user.id }}",
                name: "{{ request.user.first_name|default:request.user.username }}",
                email: "{{ request.user.email }}"
            };
            localStorage.setItem('authUser', JSON.stringify(user));
        {% else %}
            localStorage.removeItem('authUser');
        {% endif %}
    })();
</script>
