{% load static %}
{% if not "/login/" in request.path and not "/register/" in request.path %}
{% include 'cookie_banner.html' %}
<div class="hero-content" role="navigation" aria-label="Main">
    <ul class="nav-links-floating">
        <li><a href="{% url 'index' %}#home" id="nav-home">Home</a></li>
        <li><a href="{% url 'industrial_list' %}" id="nav-industrials">Industrials</a></li>
        <li><a href="{% url 'payment' %}" id="nav-payment">Payment</a></li>
        <li><a href="{% url 'feedback' %}" id="nav-feedback">Feedback's <span class="nav-arrow">â–¶</span></a></li>
    </ul>
    
    <div class="nav-actions">
        <!-- Theme Toggle -->
        <button id="themeToggle" class="theme-toggle-btn" aria-label="Toggle dark mode">
            <i class="fas fa-moon"></i>
        </button>

        {% if request.session.user_id %}
        <!-- Profile Dropdown -->
        <div class="profile-dropdown">
            <div class="profile-trigger" id="profileTrigger">
                {% if request.session.user_avatar %}
                    <img src="{{ request.session.user_avatar }}" class="user-avatar" alt="Profile">
                {% else %}
                    <div class="user-avatar-placeholder">
                        {{ request.session.user_name|slice:":1"|upper }}
                    </div>
                {% endif %}
            </div>
            <div class="profile-menu" id="profileMenu">
                <div class="profile-header">
                    <p class="user-email-text">{{ request.session.user_email }}</p>
                </div>
                <hr>
                <a href="{% url 'account' %}"><i class="fas fa-user-circle"></i> My Account</a>
                <a href="{% url 'settings' %}"><i class="fas fa-cog"></i> Settings</a>
                <a href="{% url 'logout' %}" class="logout-link"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </div>
        {% else %}
        <a href="{% url 'login' %}" class="login-nav-btn">Login</a>
        {% endif %}
    </div>
</div>
{% endif %}

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const path = window.location.pathname;
        const hash = window.location.hash;
        
        if (path === '/') {
            document.getElementById('nav-home')?.classList.add('active');
        }
        else if (path.includes('industrial')) document.getElementById('nav-industrials')?.classList.add('active');
        else if (path.includes('payment')) document.getElementById('nav-payment')?.classList.add('active');
        else if (path.includes('feedback')) document.getElementById('nav-feedback')?.classList.add('active');
    });
</script>

<script>
    // Sync Django session to localStorage for script.js and others
    (function() {
        {% if request.session.user_id %}
            const user = {
                id: "{{ request.session.user_id }}",
                name: "{{ request.session.user_name }}",
                email: "{{ request.session.user_email }}"
            };
            localStorage.setItem('authUser', JSON.stringify(user));
        {% else %}
            localStorage.removeItem('authUser');
        {% endif %}
    })();
</script>
